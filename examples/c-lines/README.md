# Embedding SQLite scripts in C

Through this example, you'll see how to embed some SQL scripts and
make it available through an array of strings, each string containing
a separate and single SQL statement.  The scripts are exposed through
C global variables and the C program only has to iterate over
the content to execute the SQL statement.

Note: the example itself does not run the SQL statement but only
prints them: the SQL statement execution is left as an exercise to
the reader :-)

The Advance Resource Embedder scans the directory and prepares the
SQLite scripts by stipping any comment, splitting the SQL statements
and preparing the result as an array of strings.

The SQL scripts are embedded by using the following
command:

```
are --lang=c -o src --rule=package.xml --var-access .
```

The `--lang=c` option selects the C generator for the output and the
`-o src` option indicates the target directory where files are generated.

The `--rule=package.xml` option indicates to read the `package.xml` file
which describes the rules to collect the resource and embed them.

The `--var-access` option tells the generator to emit a global variable
declaration for each script that was included.  The variable name is
created by using the script name.

The `package.xml` file describes a list of resources with their content.
The root XML element is `package` and each resource is described by a `resource`
XML element.  The resource is assigned a name that will be used for the C
code generation.  Each resource is generated in its separate source file.

```XML
<package>
  <resource name='Scripts'
            format='lines'
            type='struct script'>
    <line-separator>;</line-separator>

    <!-- Remove new lines -->
    <line-filter>[\r\n]</line-filter>

    <!-- Remove C comments -->
    <line-filter>/\*[^/]*\*/</line-filter>

    <!-- Remove contiguous spaces after C comments removal -->
    <line-filter replace=' '>[ \t][ \t]+</line-filter>

    <install mode='copy' strip-extension='yes'>
      <fileset dir="sql">
        <include name="**/*.sql"/>
      </fileset>
    </install>
  </resource>
</package>
```

With the above description, the C code generator produces the
following declarations:

```C
struct script {
  const char* const* content;
  size_t length;
};

enum {
   Id_create_database,
   Id_drop_database
};

extern const struct script scripts_contents[];
```

Then, the access of a given content is made through the `scripts_contents`
global array and the enumeration:

```C
for (int i = 0; i < scripts_contents[Id_create_database].length; i++) {
  puts(scripts_contents[Id_create_database].content[i]);
}

```

# Build

Run the command

```
make
```

and this generates:

* src/scripts.h: header file generated by *are*
* src/scripts.c: embedded configuration file generated by *are*
* show-script: binary that prints the SQL statements

The program usage is then:

```
show-script
```

