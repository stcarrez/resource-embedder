# Embedding help and documentation in C

This example shows how to you can embedd help and documentation files
in a C program.  This example uses a `package.xml` definition to
describe the files and the methods to collect and embed the files.
The Advance Resource Embedder scans the directory, runs the `man`
command to obtain the documentation and put the formatted result
in the final C source.  It also collects the pre-defined text documentation
located in the `help` directory.

The configuration files are embedded by using the following
command:

```
are --lang=c -o src --rule=package.xml --list-access --name-access  .
```

The `--lang=c` option selects the C generator for the output and the
`-o src` option indicates the target directory where files are generated.

The `--rule=package.xml` option indicates to read the `package.xml` file
which describes the rule to collect the resource and embedd them.

The `--list-access` option tells the generator to emit a declaration
of a sorted C array of names allowing to access the resource names.

The `--name-access` option tells the code generator to emit a C function that allows to retrieve
the resource by using its name.  To describe the content that is embedded,
a C structure is declared that gives information about the raw data content,
the content size, the modification date and data format.
The header file will declare the following structure and function declaration:

The `package.xml` file describes a list of resources with they content.
The root XML element is `package` and each resource is described by a `resource`
XML element.  The resource is assigned a name that will be used to prefix the
C function and C type declaration and also choose the file name for the generation.

The following resource definition declares the `Help` resource.  It contains
an installation rule that will copy the files under the `help` directory
in the resource set.  Only files matching the `*.txt` pattern will be taken
into account.

```XML
<package>
  <resource name='Help'
            type="man_content"
            function-name="man_get_help_content">
    <install mode='copy'>
      <fileset dir="help">
        <include name="**/*.txt"/>
      </fileset>
    </install>
  </resource>
  ...
</package>
```

The next resource definition will run an external program to get the
content that must be embedded.  The `man` directory is scanned and it
will execute the command `man #{name}` on each filename found.
That directory contains the empty files `ls`, `pwd` and `sh` and this
will run and embedd the man page for these commands.

```XML
<package>
   ...
  <resource name='Man'>
    <!-- Run the 'man X' command for each name found in the 'man' directory.
         We then include the full formatted man page of the given name. -->
    <install mode='exec'>
      <command output='#{dst}'>man #{name}</command>
      <fileset dir="man">
        <include name="*"/>
      </fileset>
    </install>
  </resource>
</package>
```


# Build

Run the command

```
make
```

and this generates:

* src/help.h: header file generated by *are* with files in `help/*.txt`,
* src/help.c: embedded documentation file generated by *are* with `help/*.txt`,
* src/man.h: header file generated by *are* with man pages from `man/*`,
* src/man.c: embedded documentation file generated by *are* with `man/*`,
* show-help: binary that prints the documentation

The program usage is then:

```
show-help
show-help ls
show-help edit
```
