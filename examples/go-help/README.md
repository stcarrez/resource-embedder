# Embedding help and documentation in Go

This example is an adaptation of the C example but in Go.

Note that Go provides an embed mechanism through the `embed.go`
package and the `go:embed` directive.

This example shows how to you can embed help and documentation files
in a Go program.  This example uses a `package.xml` definition to
describe the files and the methods to collect and embed the files.
The Advance Resource Embedder scans the directory, runs the `man`
command to obtain the documentation and put the formatted result
in the final C source.  It also collects the pre-defined text documentation
located in the `help` directory.

The configuration files are embedded by using the following
command:

```
are --lang=go --rule=package.xml --list-access --name-access  .
```

The `--lang=go` option selects the Go generator for the output.
Files are generated in a sub-directory according to the resource name.

The `--rule=package.xml` option indicates to read the `package.xml` file
which describes the rules to collect the resource and embed them.

The `--list-access` option tells the generator to make the list of
resource names public in the Go generated file.

The `--name-access` option tells the code generator to emit a Go function that allows to retrieve
the resource by using its name.  To describe the content that is embedded,
a Go structure is declared that gives information about the raw data content,
the content size, the modification date and data format.
The header file will declare the following structure and function declaration:

The `package.xml` file describes a list of resources with they content.
The root XML element is `package` and each resource is described by a `resource`
XML element.  The resource is assigned a name that will be used for the Go
package and the file name for the generation.

The following resource definition declares the `help` resource.  It contains
an installation rule that will copy the files under the `help` directory
in the resource set.  Only files matching the `*.txt` pattern will be taken
into account.

```XML
<package>
  <resource name='help'>
    <install mode='copy'>
      <fileset dir="help">
        <include name="**/*.txt"/>
      </fileset>
    </install>
  </resource>
  ...
</package>
```

The next resource definition will run an external program to get the
content that must be embedded.  The `man` directory is scanned and it
will execute the command `man #{name}` on each filename found.
That directory contains the empty files `ls`, `pwd` and `sh` and this
will run and embed the man page for these commands.

```XML
<package>
   ...
  <resource name='man'>
    <install mode='exec'>
      <command output='#{dst}'>man #{name}</command>
      <fileset dir="man">
        <include name="*"/>
        <exclude name="*.go"/>
      </fileset>
    </install>
  </resource>
</package>
```

The Go files are generated in the `help` and `man` directory.
To avoid launching the `man man.go` command which would result to an incorrect
man page, the XML definition uses the `exclude` pattern to exclude the Go files.

# Build

Run the command

```
make
```

or

```
make ARE=../../bin/are
```

and this generates:

* help/help.go: generated by *are* with files in `help/*.txt`,
* man/man.go: embedded documentation file generated by *are* with `man/*`,
* show-help: binary that prints the documentation

The program usage is then:

```
show-help
show-help ls
show-help edit
```
